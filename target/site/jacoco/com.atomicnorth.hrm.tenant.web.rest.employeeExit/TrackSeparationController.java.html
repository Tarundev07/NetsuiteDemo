<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TrackSeparationController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HR Management</a> &gt; <a href="index.source.html" class="el_package">com.atomicnorth.hrm.tenant.web.rest.employeeExit</a> &gt; <span class="el_source">TrackSeparationController.java</span></div><h1>TrackSeparationController.java</h1><pre class="source lang-java linenums">package com.atomicnorth.hrm.tenant.web.rest.employeeExit;

import com.atomicnorth.hrm.tenant.domain.employeeExit.EmpExitFinanceClearance;
import com.atomicnorth.hrm.tenant.domain.employeeExit.EmpExitInterview;
import com.atomicnorth.hrm.tenant.domain.employeeExit.EmpExitRequest;
import com.atomicnorth.hrm.tenant.service.dto.asset.EmpAssetAssignmentDTO;
import com.atomicnorth.hrm.tenant.service.dto.employeeExit.*;
import com.atomicnorth.hrm.tenant.service.employeeExit.*;
import com.atomicnorth.hrm.util.ExcelExportService;
import com.atomicnorth.hrm.util.commonClass.ApiResponse;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.InputStreamResource;
import org.springframework.core.io.Resource;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.http.*;
import org.springframework.web.bind.annotation.*;

import javax.persistence.EntityNotFoundException;
import javax.servlet.http.HttpServletRequest;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;
import java.util.Collections;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping(&quot;/api/track-separation&quot;)
<span class="nc" id="L36">public class TrackSeparationController {</span>

    @Autowired
    private TrackSeparationService trackSeparationService;
    @Autowired
    private EmpExitInterviewService exitInterviewService;
    @Autowired
    private EmpExitFinanceClearanceService exitFinanceClearanceService;
    @Autowired
    private ExcelExportService excelExportService;
    @Autowired
    private EmpExitAdminClearanceService adminClearanceService;
    @Autowired
    private EmpExitFullFinalSettlementService fullFinalSettlementService;
    @Autowired
    private  EmpExitKtHandoverService ktHandoverService;

    @GetMapping(&quot;track&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Object&gt;&gt; trackSeparation(@RequestParam(value = &quot;employeeId&quot;, required = false) Integer employeeId) {
        try {
<span class="nc" id="L56">            TrackSeparationDTO separationDTO = trackSeparationService.track(employeeId);</span>
<span class="nc" id="L57">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(separationDTO, true, &quot;TRACK_SEPRATION_FETHCED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L58">        } catch (Exception e) {</span>
<span class="nc" id="L59">            return ResponseEntity.status(HttpStatus.OK).body(new ApiResponse&lt;&gt;(null, false, &quot;TRACK_SEPRATION_FETHCED_FAILED&quot;, &quot;FAILURE&quot;, Collections.singletonList(e.getMessage())));</span>
        }
    }

    @GetMapping(&quot;separation-list&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; separationList(
            @RequestParam(defaultValue = &quot;1&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size,
            @RequestParam(value = &quot;sortBy&quot;, defaultValue = &quot;id&quot;, required = false) String sortBy,
            @RequestParam(value = &quot;sortDir&quot;, defaultValue = &quot;desc&quot;, required = false) String sortDir,
            @RequestParam(value = &quot;searchKeyword&quot;, required = false) String searchKeyword,
            @RequestParam(value = &quot;searchField&quot;, required = false) String searchField
    ) {
        try {
<span class="nc" id="L73">            Pageable pageable = PageRequest.of(page - 1, size, Sort.Direction.fromString(sortDir), sortBy);</span>
<span class="nc" id="L74">            Map&lt;String, Object&gt; separationList = trackSeparationService.separationList(sortBy, sortDir, searchField, searchKeyword, pageable);</span>
<span class="nc" id="L75">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(separationList, true, &quot;SEPARATION_LIST_FETCH_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L76">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L77">            return ResponseEntity.status(HttpStatus.OK).body(new ApiResponse&lt;&gt;(null, false, &quot;SEPARATION_LIST_FETCH_FAILED&quot;, &quot;FAILURE&quot;, Collections.singletonList(e.getMessage())));</span>
        }
    }

    @GetMapping(&quot;/asset-ClearanceList&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; assetClearanceList(
            @RequestParam(defaultValue = &quot;1&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size,
            @RequestParam(value = &quot;sortBy&quot;, defaultValue = &quot;exitRequestId&quot;, required = false) String sortBy,
            @RequestParam(value = &quot;sortDir&quot;, defaultValue = &quot;desc&quot;, required = false) String sortDir,
            @RequestParam(value = &quot;searchField&quot;, required = false) String searchField,
            @RequestParam(value = &quot;searchKeyword&quot;, required = false) String searchKeyword
    ) {
        try {
<span class="nc" id="L91">            Pageable pageable = PageRequest.of(page - 1, size, Sort.Direction.fromString(sortDir), sortBy);</span>
<span class="nc" id="L92">            Map&lt;String, Object&gt; clearanceList = trackSeparationService.getAllAssetClearanceList(sortBy, sortDir, searchField, searchKeyword, pageable);</span>
<span class="nc" id="L93">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(clearanceList, true, &quot;ASSET_CLEARANCE_LIST_FETCHED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L94">        } catch (Exception e) {</span>
<span class="nc" id="L95">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;ASSET_CLEARANCE_LIST_FETCHED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @GetMapping(&quot;/exitInterviewDetails&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitInterviewDTO&gt;&gt; getExitInterviewDetails
            (@RequestParam(value = &quot;exitRequestId&quot;) Integer exitRequestId) {
        try {
<span class="nc" id="L103">            EmpExitInterviewDTO exitInterviewDetails = exitInterviewService.getExitInterviewDetails(exitRequestId);</span>
<span class="nc" id="L104">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(exitInterviewDetails, true, &quot;EXIT_INTERVIEW_DETAILS_FETCH_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L105">        } catch (EntityNotFoundException e) {</span>
<span class="nc" id="L106">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;EXIT_INTERVIEW_DETAILS_FETCH_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @PostMapping(&quot;/saveExitInterview&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitInterview&gt;&gt; saveExitInterview(@RequestBody EmpExitInterviewDTO
                                                                                   exitInterviewDTO) {
        try {
<span class="nc" id="L114">            EmpExitInterview empExitInterview = exitInterviewService.saveExitInterview(exitInterviewDTO);</span>
<span class="nc" id="L115">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(empExitInterview, true, &quot;EXIT_INTERVIEW_DETAILS_SAVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L116">        } catch (EntityNotFoundException e) {</span>
<span class="nc" id="L117">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;EXIT_INTERVIEW_DETAILS_SAVED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @GetMapping(&quot;/finance-clearance-list&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; financeClearanceList(
            @RequestParam(defaultValue = &quot;1&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size,
            @RequestParam(value = &quot;sortBy&quot;, defaultValue = &quot;id&quot;, required = false) String sortBy,
            @RequestParam(value = &quot;sortDir&quot;, defaultValue = &quot;desc&quot;, required = false) String sortDir,
            @RequestParam(value = &quot;searchField&quot;, required = false) String searchField,
            @RequestParam(value = &quot;searchKeyword&quot;, required = false) String searchKeyword
    ) {
        try {
<span class="nc" id="L131">            Pageable pageable = PageRequest.of(page - 1, size, Sort.Direction.fromString(sortDir), sortBy);</span>
<span class="nc" id="L132">            Map&lt;String, Object&gt; clearanceList = trackSeparationService.getAllFinanceClearanceList(sortBy, sortDir, searchField, searchKeyword, pageable);</span>
<span class="nc" id="L133">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(clearanceList, true, &quot;FINANCE_CLEARANCE_LIST_FETCHED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L134">        } catch (Exception e) {</span>
<span class="nc" id="L135">            return new ResponseEntity&lt;&gt;(</span>
<span class="nc" id="L136">                    new ApiResponse&lt;&gt;(null, false, &quot;FINANCE_CLEARANCE_LIST_FETCHED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())),</span>
                    HttpStatus.OK
            );
        }
    }

    @GetMapping(&quot;/admin-clearance-list&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; adminClearanceList(
            @RequestParam(defaultValue = &quot;1&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size,
            @RequestParam(value = &quot;sortBy&quot;, defaultValue = &quot;exitRequestId&quot;, required = false) String sortBy,
            @RequestParam(value = &quot;sortDir&quot;, defaultValue = &quot;desc&quot;, required = false) String sortDir,
            @RequestParam(value = &quot;searchField&quot;, required = false) String searchField,
            @RequestParam(value = &quot;searchKeyword&quot;, required = false) String searchKeyword
    ) {
        try {
<span class="nc" id="L152">            Pageable pageable = PageRequest.of(page - 1, size, Sort.Direction.fromString(sortDir), sortBy);</span>

<span class="nc" id="L154">            Map&lt;String, Object&gt; clearanceList = trackSeparationService.getAllAdminClearanceList(</span>
                    sortBy, sortDir, searchField, searchKeyword, pageable
            );

<span class="nc" id="L158">            return ResponseEntity.ok(</span>
                    new ApiResponse&lt;&gt;(clearanceList, true, &quot;ADMIN_CLEARANCE_LIST_FETCHED_SUCCESS&quot;, &quot;SUCCESS&quot;)
            );
<span class="nc" id="L161">        } catch (Exception e) {</span>
<span class="nc" id="L162">            return new ResponseEntity&lt;&gt;(</span>
<span class="nc" id="L163">                    new ApiResponse&lt;&gt;(null, false, &quot;ADMIN_CLEARANCE_LIST_FETCHED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())),</span>
                    HttpStatus.OK
            );
        }
    }

    @PostMapping(&quot;approveExitInterview&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitRequest&gt;&gt; approveExitInterview
            (@RequestParam(value = &quot;exitRequestId&quot;) Integer exitRequestId) {
        try {
<span class="nc" id="L173">            EmpExitRequest empExitRequest = exitInterviewService.approveExitInterview(exitRequestId);</span>
<span class="nc" id="L174">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(empExitRequest, true, &quot;EXIT_INTERVIEW_DETAILS_APPROVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L175">        } catch (EntityNotFoundException | IllegalArgumentException e) {</span>
<span class="nc" id="L176">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;EXIT_INTERVIEW_DETAILS_APPROVED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @GetMapping(&quot;/kt-handover-list&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; ktHandoverList(
            @RequestParam(defaultValue = &quot;1&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size,
            @RequestParam(value = &quot;sortBy&quot;, defaultValue = &quot;id&quot;, required = false) String sortBy,
            @RequestParam(value = &quot;sortDir&quot;, defaultValue = &quot;desc&quot;, required = false) String sortDir,
            @RequestParam(value = &quot;searchField&quot;, required = false) String searchField,
            @RequestParam(value = &quot;searchKeyword&quot;, required = false) String searchKeyword
    ) {
        try {
<span class="nc" id="L190">            Pageable pageable = PageRequest.of(page - 1, size, Sort.Direction.fromString(sortDir), sortBy);</span>

<span class="nc" id="L192">            Map&lt;String, Object&gt; ktList = trackSeparationService.getallKtHandoverList(</span>
                    sortBy, sortDir, searchField, searchKeyword, pageable
            );

<span class="nc" id="L196">            return ResponseEntity.ok(</span>
                    new ApiResponse&lt;&gt;(ktList, true, &quot;KT_HANDOVER_LIST_FETCHED_SUCCESS&quot;, &quot;SUCCESS&quot;)
            );
<span class="nc" id="L199">        } catch (Exception e) {</span>
<span class="nc" id="L200">            return new ResponseEntity&lt;&gt;(</span>
<span class="nc" id="L201">                    new ApiResponse&lt;&gt;(null, false, &quot;KT_HANDOVER_LIST_FETCHED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())),</span>
                    HttpStatus.OK
            );
        }
    }

    @GetMapping(&quot;financeClearanceDetails&quot;)
    public ResponseEntity&lt;ApiResponse&lt;FinanceClearanceDTO&gt;&gt; getFinanceClearanceDetails
            (@RequestParam(value = &quot;exitRequestId&quot;) Integer exitRequestId, HttpServletRequest request) {
        try {
<span class="nc" id="L211">            FinanceClearanceDTO financeClearanceDetails = exitFinanceClearanceService.getFinanceClearanceDetails(exitRequestId, request);</span>
<span class="nc" id="L212">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(financeClearanceDetails, true, &quot;FINANCE_CLEARANCE_DETAILS_FETCH_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L213">        } catch (EntityNotFoundException e) {</span>
<span class="nc" id="L214">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;FINANCE_CLEARANCE_DETAILS_FETCH_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @PostMapping(&quot;approveFinanceClearance&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitRequest&gt;&gt; approveFinanceClearance
            (@RequestParam(value = &quot;exitRequestId&quot;) Integer exitRequestId) {
        try {
<span class="nc" id="L222">            EmpExitRequest empExitRequest = exitFinanceClearanceService.approveFinanceClearance(exitRequestId);</span>
<span class="nc" id="L223">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(empExitRequest, true, &quot;FINANCE_CLEARANCE_APPROVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L224">        } catch (EntityNotFoundException | IllegalArgumentException e) {</span>
<span class="nc" id="L225">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;FINANCE_CLEARANCE_APPROVED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @PostMapping(&quot;saveFinanceClearance&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitFinanceClearance&gt;&gt; saveFinanceClearance(
            @RequestPart(&quot;data&quot;) FinanceClearanceDTO financeClearanceDTO,
            @RequestPart(value = &quot;file&quot;, required = false) MultipartFile file) {
        try {
<span class="nc" id="L234">            EmpExitFinanceClearance exitFinanceClearance = exitFinanceClearanceService.saveFinanceClearance(financeClearanceDTO, file);</span>
<span class="nc" id="L235">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(exitFinanceClearance, true, &quot;FINANCE_CLEARANCE_SAVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L236">        } catch (RuntimeException e) {</span>
<span class="nc" id="L237">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;FINANCE_CLEARANCE_SAVED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @GetMapping(&quot;/download/{financeDetailsId}&quot;)
    public ResponseEntity&lt;Resource&gt; downloadAssetClearanceFile(@PathVariable Integer financeDetailsId) {
        try {
<span class="nc" id="L244">            Map&lt;String, Object&gt; objectMap = exitFinanceClearanceService.downloadFile(financeDetailsId);</span>
<span class="nc" id="L245">            Resource resource = (Resource) objectMap.get(&quot;resource&quot;);</span>
<span class="nc" id="L246">            String contentType = (String) objectMap.get(&quot;contentType&quot;);</span>
<span class="nc" id="L247">            return ResponseEntity.ok()</span>
<span class="nc" id="L248">                    .contentType(MediaType.parseMediaType(contentType))</span>
<span class="nc" id="L249">                    .header(HttpHeaders.CONTENT_DISPOSITION, &quot;attachment; filename=\&quot;&quot; + resource.getFilename() + &quot;\&quot;&quot;)</span>
<span class="nc" id="L250">                    .body(resource);</span>
<span class="nc" id="L251">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L252">            return ResponseEntity.status(HttpStatus.NOT_FOUND).build();</span>
<span class="nc" id="L253">        } catch (IOException e) {</span>
<span class="nc" id="L254">            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span>
        }
    }

    @GetMapping(&quot;financeClearanceSheet/{financeId}&quot;)
    public ResponseEntity&lt;InputStreamResource&gt; financeClearanceSheet(@PathVariable Integer financeId) {
        try {
<span class="nc" id="L261">            List&lt;FinanceClearanceDetailsDTO&gt; detailsDTO = exitFinanceClearanceService.detailsData(financeId);</span>
<span class="nc" id="L262">            return excelExportService.exportToExcel(detailsDTO, &quot;finance_clearance_sheet&quot;);</span>
<span class="nc" id="L263">        } catch (Exception e) {</span>
<span class="nc" id="L264">            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span>
        }
    }

    @GetMapping(&quot;getAdminClearanceData&quot;)
    public ResponseEntity&lt;ApiResponse&lt;List&lt;EmpAssetAssignmentDTO&gt;&gt;&gt; getAdminClearanceData
            (@RequestParam(value = &quot;employeeId&quot;) Integer employeeId, HttpServletRequest request) {
        try {
<span class="nc" id="L272">            List&lt;EmpAssetAssignmentDTO&gt; adminClearanceData = adminClearanceService.getAdminClearanceData(employeeId, request);</span>
<span class="nc" id="L273">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(adminClearanceData, true, &quot;ADMIN_CLEARANCE_DATA_FETCHED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L274">        } catch (EntityNotFoundException e) {</span>
<span class="nc" id="L275">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;ADMIN_CLEARANCE_DATA_FETCHED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @PostMapping(&quot;approveAdminClearance&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitRequest&gt;&gt; approveAdminClearance
            (@RequestParam(value = &quot;employeeId&quot;) Integer employeeId) {
        try {
<span class="nc" id="L283">            EmpExitRequest empExitRequest = adminClearanceService.approveAdminClearance(employeeId);</span>
<span class="nc" id="L284">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(empExitRequest, true, &quot;ADMIN_CLEARANCE_APPROVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L285">        } catch (EntityNotFoundException | IllegalArgumentException e) {</span>
<span class="nc" id="L286">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;ADMIN_CLEARANCE_APPROVED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @PostMapping(&quot;saveAdminClearance&quot;)
    public ResponseEntity&lt;ApiResponse&lt;List&lt;EmpAssetAssignmentDTO&gt;&gt;&gt; saveAdminClearance(
            @RequestPart(&quot;data&quot;) List&lt;EmpAssetAssignmentDTO&gt; request,
            @RequestParam(required = false) Map&lt;String, MultipartFile&gt; files
    ) {
        try {
<span class="nc" id="L296">            List&lt;EmpAssetAssignmentDTO&gt; empAssetAssignmentDTOS = adminClearanceService.saveAdminClearance(request, files);</span>
<span class="nc" id="L297">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(empAssetAssignmentDTOS, true, &quot;ADMIN_CLEARANCE_DETAILS_SAVE_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L298">        } catch (IOException e) {</span>
<span class="nc" id="L299">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;ADMIN_CLEARANCE_DETAILS_SAVE_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }


    @GetMapping(&quot;/kt-handover-details&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitKtHandoverDTO&gt;&gt; getKtHandoverDetails(
            @RequestParam(value = &quot;exitRequestId&quot;) Integer exitRequestId) {
        try {
<span class="nc" id="L308">            EmpExitKtHandoverDTO dto = ktHandoverService.getAllKtHandoverList(exitRequestId);</span>

<span class="nc" id="L310">            return ResponseEntity.ok(</span>
                    new ApiResponse&lt;&gt;(
                            dto,
                            true,
                            &quot;KT_HANDOVER_DETAILS_FETCH_SUCCESS&quot;,
                            &quot;SUCCESS&quot;
                    )
            );

<span class="nc" id="L319">        } catch (EntityNotFoundException e) {</span>
<span class="nc" id="L320">            return ResponseEntity.ok(</span>
                    new ApiResponse&lt;&gt;(
                            null,
                            false,
                            &quot;KT_HANDOVER_DETAILS_FETCH_ERROR&quot;,
                            &quot;ERROR&quot;,
<span class="nc" id="L326">                            Collections.singletonList(e.getMessage())</span>
                    )
            );
        }
    }

    @PostMapping(&quot;saveKtHandover&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitKtHandoverDTO&gt;&gt; saveKtHandover(
            @RequestPart(&quot;data&quot;) EmpExitKtHandoverDTO dto,
            @RequestParam(value = &quot;exitRequestId&quot;) Integer exitRequestId,
            @RequestParam(required = false) Map&lt;String, MultipartFile&gt; files) {
        try {
<span class="nc" id="L338">            EmpExitKtHandoverDTO saved = ktHandoverService.saveKtHandover(dto, files, exitRequestId);</span>
<span class="nc" id="L339">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(saved, true, &quot;KT_HANDOVER_SAVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L340">        } catch (IOException e) {</span>
<span class="nc" id="L341">            return new ResponseEntity&lt;&gt;(</span>
<span class="nc" id="L342">                    new ApiResponse&lt;&gt;(null, false, &quot;KT_HANDOVER_FILE_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())),</span>
                    HttpStatus.OK
            );
        }
    }

    @GetMapping(&quot;/kt-download/{id}&quot;)
    public ResponseEntity&lt;Resource&gt; downloadKtDocsFile(@PathVariable Integer id) {
        try {
<span class="nc" id="L351">            Map&lt;String, Object&gt; objectMap = ktHandoverService.downloadKtDocs(id);</span>
<span class="nc" id="L352">            Resource resource = (Resource) objectMap.get(&quot;resource&quot;);</span>
<span class="nc" id="L353">            String contentType = (String) objectMap.get(&quot;contentType&quot;);</span>
<span class="nc" id="L354">            return ResponseEntity.ok()</span>
<span class="nc" id="L355">                    .contentType(MediaType.parseMediaType(contentType))</span>
<span class="nc" id="L356">                    .header(HttpHeaders.CONTENT_DISPOSITION, &quot;attachment; filename=\&quot;&quot; + resource.getFilename() + &quot;\&quot;&quot;)</span>
<span class="nc" id="L357">                    .body(resource);</span>
<span class="nc" id="L358">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L359">            return ResponseEntity.status(HttpStatus.NOT_FOUND).build();</span>
<span class="nc" id="L360">        } catch (IOException e) {</span>
<span class="nc" id="L361">            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span>
        }
    }

    @PostMapping(&quot;approveKt&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitRequest&gt;&gt; approveKtt(@RequestParam(value = &quot;id&quot;) Integer id) {
        try {
<span class="nc" id="L368">            EmpExitRequest empExitRequest = ktHandoverService.approveKt(id);</span>
<span class="nc" id="L369">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(empExitRequest, true, &quot;FINANCE_CLEARANCE_APPROVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L370">        } catch (EntityNotFoundException | IllegalArgumentException e) {</span>
<span class="nc" id="L371">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;FINANCE_CLEARANCE_APPROVED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @GetMapping(&quot;getFnFDetails&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitFullFinalSettlementDTO&gt;&gt; getFnFDetails(@RequestParam(value = &quot;exitRequestId&quot;) Integer exitRequestId, HttpServletRequest request) {
        try {
<span class="nc" id="L378">            EmpExitFullFinalSettlementDTO fnFDetails = fullFinalSettlementService.getFnFDetails(exitRequestId, request);</span>
<span class="nc" id="L379">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(fnFDetails, true, &quot;FNF_DATA_FETCHED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L380">        } catch (EntityNotFoundException e) {</span>
<span class="nc" id="L381">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;FNF_DATA_FETCHED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @PostMapping(&quot;saveFnFDetails&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitFullFinalSettlementDTO&gt;&gt; saveFnFDetails(@RequestPart(&quot;data&quot;) EmpExitFullFinalSettlementDTO settlementDTO, @RequestPart(name = &quot;file&quot;, required = false) MultipartFile file) {
        try {
<span class="nc" id="L388">            EmpExitFullFinalSettlementDTO settlement = fullFinalSettlementService.saveFnFDetails(settlementDTO, file);</span>
<span class="nc" id="L389">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(settlement, true, &quot;FNF_DETAILS_SAVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L390">        } catch (RuntimeException e) {</span>
<span class="nc" id="L391">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;FNF_DETAILS_SAVED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @PostMapping(&quot;approveFnFRequest&quot;)
    public ResponseEntity&lt;ApiResponse&lt;EmpExitRequest&gt;&gt; approveFnFRequest(@RequestParam(value = &quot;exitRequestId&quot;) Integer exitRequestId) {
        try {
<span class="nc" id="L398">            EmpExitRequest empExitRequest = fullFinalSettlementService.approveFnFRequest(exitRequestId);</span>
<span class="nc" id="L399">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(empExitRequest, true, &quot;FNF_CLEARANCE_APPROVED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L400">        } catch (EntityNotFoundException | IllegalArgumentException e) {</span>
<span class="nc" id="L401">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;FNF_CLEARANCE_APPROVED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }

    @GetMapping(&quot;/fnfDownload/{fnfId}&quot;)
    public ResponseEntity&lt;Resource&gt; downloadFnFDocumentFile(@PathVariable Integer fnfId) {
        try {
<span class="nc" id="L408">            Map&lt;String, Object&gt; objectMap = fullFinalSettlementService.downloadFile(fnfId);</span>
<span class="nc" id="L409">            Resource resource = (Resource) objectMap.get(&quot;resource&quot;);</span>
<span class="nc" id="L410">            String contentType = (String) objectMap.get(&quot;contentType&quot;);</span>
<span class="nc" id="L411">            return ResponseEntity.ok()</span>
<span class="nc" id="L412">                    .contentType(MediaType.parseMediaType(contentType))</span>
<span class="nc" id="L413">                    .header(HttpHeaders.CONTENT_DISPOSITION, &quot;attachment; filename=\&quot;&quot; + resource.getFilename() + &quot;\&quot;&quot;)</span>
<span class="nc" id="L414">                    .body(resource);</span>
<span class="nc" id="L415">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L416">            return ResponseEntity.status(HttpStatus.NOT_FOUND).build();</span>
<span class="nc" id="L417">        } catch (IOException e) {</span>
<span class="nc" id="L418">            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span>
        }
    }

    @GetMapping(&quot;/fnf-list&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; fnfList(
            @RequestParam(defaultValue = &quot;1&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size,
            @RequestParam(value = &quot;sortBy&quot;, defaultValue = &quot;exitRequestId&quot;, required = false) String sortBy,
            @RequestParam(value = &quot;sortDir&quot;, defaultValue = &quot;desc&quot;, required = false) String sortDir,
            @RequestParam(value = &quot;searchField&quot;, required = false) String searchField,
            @RequestParam(value = &quot;searchKeyword&quot;, required = false) String searchKeyword
    ) {
        try {
<span class="nc" id="L432">            Pageable pageable = PageRequest.of(page - 1, size, Sort.Direction.fromString(sortDir), sortBy);</span>
<span class="nc" id="L433">            Map&lt;String, Object&gt; clearanceList = fullFinalSettlementService.getAllFnfList(sortBy, sortDir, searchField, searchKeyword, pageable);</span>
<span class="nc" id="L434">            return ResponseEntity.ok(new ApiResponse&lt;&gt;(clearanceList, true, &quot;ASSET_CLEARANCE_LIST_FETCHED_SUCCESS&quot;, &quot;SUCCESS&quot;));</span>
<span class="nc" id="L435">        } catch (Exception e) {</span>
<span class="nc" id="L436">            return new ResponseEntity&lt;&gt;(new ApiResponse&lt;&gt;(null, false, &quot;ASSET_CLEARANCE_LIST_FETCHED_ERROR&quot;, &quot;ERROR&quot;, Collections.singletonList(e.getMessage())), HttpStatus.OK);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>