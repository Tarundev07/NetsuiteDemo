<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JobApplicantController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HR Management</a> &gt; <a href="index.source.html" class="el_package">com.atomicnorth.hrm.tenant.web.rest.employement.employee_job_applicant</a> &gt; <span class="el_source">JobApplicantController.java</span></div><h1>JobApplicantController.java</h1><pre class="source lang-java linenums">package com.atomicnorth.hrm.tenant.web.rest.employement.employee_job_applicant;

import com.atomicnorth.hrm.tenant.repository.employement.employee_job_applicant.JobApplicantRepository;
import com.atomicnorth.hrm.tenant.service.dto.employement.employee_job_applicant.JobApplicantDTO;
import com.atomicnorth.hrm.tenant.service.employement.employee_job_applicant.JobApplicantService;
import com.atomicnorth.hrm.util.commonClass.ApiResponse;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.Resource;
import org.springframework.core.io.UrlResource;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.http.*;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import javax.persistence.EntityNotFoundException;
import javax.servlet.http.HttpServletRequest;
import javax.validation.Valid;
import java.io.File;
import java.io.FileNotFoundException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Collections;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping(&quot;/api/jobApplicant&quot;)
<span class="nc" id="L33">public class JobApplicantController {</span>

<span class="nc" id="L35">    private final Logger log = LoggerFactory.getLogger(JobApplicantController.class);</span>
    @Autowired
    private JobApplicantService service;
    @Autowired
    private JobApplicantRepository jobApplicantRepository;

    @PostMapping(&quot;/saveOrUpdateResume&quot;)
    public ResponseEntity&lt;ApiResponse&lt;JobApplicantDTO&gt;&gt; saveOrUpdateJobApplicant(
            @RequestPart(&quot;request&quot;) @Valid JobApplicantDTO request,
            @RequestPart(value = &quot;resumeAttachment&quot;, required = false) MultipartFile resumeAttachment
    ) {
        try {
<span class="nc" id="L47">            log.info(&quot;Received request to save or update job applicant: {}&quot;, request);</span>
<span class="nc" id="L48">            JobApplicantDTO responseDTO = service.saveOrUpdateJobApplicant(request, resumeAttachment);</span>

<span class="nc" id="L50">            ApiResponse&lt;JobApplicantDTO&gt; response = new ApiResponse&lt;&gt;(</span>
                    responseDTO, true, &quot;JOB-APPLICANT-SAVE-OR-UPDATE-SUCCESS&quot;, &quot;Information&quot;
            );
<span class="nc" id="L53">            return ResponseEntity.status(HttpStatus.OK).body(response);</span>

<span class="nc" id="L55">        } catch (Exception ex) {</span>
<span class="nc" id="L56">            log.error(&quot;Error occurred while processing job applicant: &quot;, ex);</span>
<span class="nc" id="L57">            ApiResponse&lt;JobApplicantDTO&gt; errorResponse = new ApiResponse&lt;&gt;(</span>
                    null, false, &quot;JOB-APPLICANT-SAVE-OR-UPDATE-FAILURE&quot;, &quot;Error&quot;,
<span class="nc" id="L59">                    List.of(ex.getMessage(), &quot;Please contact support.&quot;)</span>
            );
<span class="nc" id="L61">            return ResponseEntity.status(HttpStatus.OK).body(errorResponse);</span>
        }
    }

    @GetMapping(&quot;/getAllData&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; getAllJobApplicants(
            @RequestParam(defaultValue = &quot;1&quot;) int pageNumber,
            @RequestParam(defaultValue = &quot;10&quot;) int pageSize,
            @RequestParam(value = &quot;sortBy&quot;, defaultValue = &quot;id&quot;, required = false) String sortBy,
            @RequestParam(value = &quot;sortDir&quot;, defaultValue = &quot;desc&quot;, required = false) String sortDir,
            @RequestParam(required = false) String searchColumn,
            @RequestParam(required = false) String searchValue
    ) {
        try {
<span class="nc bnc" id="L75" title="All 2 branches missed.">            if (pageNumber &lt; 1) {</span>
<span class="nc" id="L76">                throw new IllegalArgumentException(&quot;Page number must be 1 or greater.&quot;);</span>
            }
<span class="nc" id="L78">            Sort sort = Sort.by(Sort.Direction.fromString(sortDir), sortBy);</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">            if (&quot;designationName&quot;.equals(sortBy)) {</span>
<span class="nc" id="L80">                sort = Sort.by(Sort.Direction.fromString(sortDir), &quot;designationEntity.designationName&quot;);</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">            } else if (&quot;jobOpeningName&quot;.equals(sortBy)) {</span>
<span class="nc" id="L82">                sort = Sort.by(Sort.Direction.fromString(sortDir), &quot;jobOpening.jobTitle&quot;);</span>
            }
<span class="nc" id="L84">            Pageable pageable = PageRequest.of(pageNumber - 1, pageSize, sort);</span>
<span class="nc" id="L85">            Map&lt;String, Object&gt; paginatedApplicants =</span>
<span class="nc" id="L86">                    service.getAllJobApplicants(pageable, searchColumn, searchValue);</span>

<span class="nc" id="L88">            ApiResponse&lt;Map&lt;String, Object&gt;&gt; response = new ApiResponse&lt;&gt;(</span>
                    paginatedApplicants, true, &quot;JOB-APPLICANTS-RETRIEVED-SUCCESSFULLY&quot;, &quot;Information&quot;);

<span class="nc" id="L91">            return ResponseEntity.ok(response);</span>
<span class="nc" id="L92">        } catch (IllegalArgumentException ex) {</span>
<span class="nc" id="L93">            ApiResponse&lt;Map&lt;String, Object&gt;&gt; warningResponse = new ApiResponse&lt;&gt;(</span>
                    null, false, &quot;JOB-APPLICANTS-RETRIEVAL-FAILED&quot;, &quot;Warning&quot;,
<span class="nc" id="L95">                    List.of(ex.getMessage()));</span>

<span class="nc" id="L97">            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(warningResponse);</span>
<span class="nc" id="L98">        } catch (Exception ex) {</span>
<span class="nc" id="L99">            ApiResponse&lt;Map&lt;String, Object&gt;&gt; errorResponse = new ApiResponse&lt;&gt;(</span>
                    null, false, &quot;JOB-APPLICANTS-RETRIEVAL-FAILED&quot;, &quot;Error&quot;,
<span class="nc" id="L101">                    List.of(ex.getMessage(), &quot;Please contact support.&quot;));</span>

<span class="nc" id="L103">            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);</span>
        }
    }

    @GetMapping(&quot;/getById/{id}&quot;)
    public ResponseEntity&lt;ApiResponse&lt;JobApplicantDTO&gt;&gt; getJobApplicantById(@PathVariable Integer id) {
        try {
<span class="nc" id="L110">            JobApplicantDTO applicant = service.getJobApplicantById(id);</span>
<span class="nc" id="L111">            ApiResponse&lt;JobApplicantDTO&gt; response = new ApiResponse&lt;&gt;(</span>
                    applicant, true, &quot;JOB-APPLICANT-RETRIEVED-SUCCESSFULLY&quot;, &quot;Information&quot;);
<span class="nc" id="L113">            return ResponseEntity.ok(response);</span>
<span class="nc" id="L114">        } catch (EntityNotFoundException ex) {</span>
<span class="nc" id="L115">            ApiResponse&lt;JobApplicantDTO&gt; errorResponse = new ApiResponse&lt;&gt;(</span>
                    null, false, &quot;JOB-APPLICANT-NOT-FOUND&quot;, &quot;Warning&quot;,
<span class="nc" id="L117">                    List.of(ex.getMessage()));</span>
<span class="nc" id="L118">            return ResponseEntity.status(HttpStatus.OK).body(errorResponse);</span>
<span class="nc" id="L119">        } catch (Exception ex) {</span>
<span class="nc" id="L120">            ApiResponse&lt;JobApplicantDTO&gt; errorResponse = new ApiResponse&lt;&gt;(</span>
                    null, false, &quot;JOB-APPLICANT-RETRIEVAL-FAILED&quot;, &quot;Error&quot;,
<span class="nc" id="L122">                    List.of(ex.getMessage(), &quot;Please contact support.&quot;));</span>
<span class="nc" id="L123">            return ResponseEntity.status(HttpStatus.OK).body(errorResponse);</span>
        }
    }

    @GetMapping(&quot;/downloadResume/**&quot;)
    public ResponseEntity&lt;Resource&gt; downloadResume(HttpServletRequest request) {
        try {
<span class="nc" id="L130">            String filePath = request.getRequestURI().split(&quot;/downloadResume/&quot;)[1];</span>

<span class="nc" id="L132">            Path path = Paths.get(filePath).normalize();</span>
<span class="nc" id="L133">            File file = path.toFile();</span>

<span class="nc bnc" id="L135" title="All 4 branches missed.">            if (!file.exists() || !file.isFile()) {</span>
<span class="nc" id="L136">                throw new FileNotFoundException(&quot;File not found: &quot; + filePath);</span>
            }

<span class="nc" id="L139">            Resource resource = new UrlResource(file.toURI());</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">            if (!resource.exists()) {</span>
<span class="nc" id="L141">                throw new FileNotFoundException(&quot;File resource not found: &quot; + filePath);</span>
            }

<span class="nc" id="L144">            String contentType = Files.probeContentType(path);</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">            if (contentType == null) {</span>
<span class="nc" id="L146">                contentType = &quot;application/octet-stream&quot;;</span>
            }

<span class="nc" id="L149">            return ResponseEntity.ok()</span>
<span class="nc" id="L150">                    .contentType(MediaType.parseMediaType(contentType))</span>
<span class="nc" id="L151">                    .header(HttpHeaders.CONTENT_DISPOSITION, &quot;attachment; filename=\&quot;&quot; + file.getName() + &quot;\&quot;&quot;)</span>
<span class="nc" id="L152">                    .body(resource);</span>
<span class="nc" id="L153">        } catch (Exception ex) {</span>
<span class="nc" id="L154">            return ResponseEntity.status(HttpStatus.OK)</span>
<span class="nc" id="L155">                    .body(null);</span>
        }
    }

    @GetMapping(&quot;/downloadResumeByteCode/**&quot;)
    public ResponseEntity&lt;byte[]&gt; downloadResumeByteCode(HttpServletRequest request) {
        try {
<span class="nc" id="L162">            String uri = request.getRequestURI();</span>
<span class="nc" id="L163">            System.out.println(&quot;Requested URI: &quot; + uri);</span>
<span class="nc" id="L164">            String filePath = uri.split(&quot;/downloadResumeByteCode/&quot;)[1];</span>
<span class="nc" id="L165">            System.out.println(&quot;Extracted File Path: &quot; + filePath);</span>

<span class="nc" id="L167">            Path fullPath = Paths.get(filePath).normalize();</span>
<span class="nc" id="L168">            System.out.println(&quot;Resolved Full File Path: &quot; + fullPath);</span>

<span class="nc" id="L170">            File file = fullPath.toFile();</span>
<span class="nc bnc" id="L171" title="All 4 branches missed.">            if (!file.exists() || !file.isFile()) {</span>
<span class="nc" id="L172">                throw new FileNotFoundException(&quot;File not found at path: &quot; + fullPath);</span>
            }

<span class="nc" id="L175">            byte[] fileBytes = Files.readAllBytes(fullPath);</span>

<span class="nc" id="L177">            String contentType = Files.probeContentType(fullPath);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (contentType == null) {</span>
<span class="nc" id="L179">                contentType = &quot;application/octet-stream&quot;;</span>
            }

<span class="nc" id="L182">            HttpHeaders headers = new HttpHeaders();</span>
<span class="nc" id="L183">            headers.setContentType(MediaType.parseMediaType(contentType));</span>
<span class="nc" id="L184">            headers.setContentDisposition(ContentDisposition.attachment().filename(file.getName()).build());</span>

<span class="nc" id="L186">            return ResponseEntity.ok()</span>
<span class="nc" id="L187">                    .headers(headers)</span>
<span class="nc" id="L188">                    .body(fileBytes);</span>

<span class="nc" id="L190">        } catch (FileNotFoundException ex) {</span>
<span class="nc" id="L191">            System.err.println(&quot;File not found: &quot; + ex.getMessage());</span>
<span class="nc" id="L192">            return ResponseEntity.status(HttpStatus.OK)</span>
<span class="nc" id="L193">                    .body(null);</span>
<span class="nc" id="L194">        } catch (Exception ex) {</span>
<span class="nc" id="L195">            System.err.println(&quot;Error: &quot; + ex.getMessage());</span>
<span class="nc" id="L196">            return ResponseEntity.status(HttpStatus.OK)</span>
<span class="nc" id="L197">                    .body(null);</span>
        }
    }

    @GetMapping(&quot;/details&quot;)
    public ResponseEntity&lt;ApiResponse&lt;List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; getApplicantDetails() {
        try {
<span class="nc" id="L204">            List&lt;Map&lt;String, Object&gt;&gt; employees = service.findApplicantDetails();</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">            if (employees.isEmpty()) {</span>
<span class="nc" id="L206">                return new ResponseEntity&lt;&gt;(</span>
                        new ApiResponse&lt;&gt;(null, false, &quot;APPLICANT_DETAILS_NOT_FOUND&quot;, &quot;FAILURE&quot;,
<span class="nc" id="L208">                                Collections.singletonList(&quot;No Applicant details found.&quot;)),</span>
                        HttpStatus.OK);
            }
<span class="nc" id="L211">            return ResponseEntity.ok(</span>
                    new ApiResponse&lt;&gt;(employees, true, &quot;APPLICANT_DETAILS_FETCHED&quot;, &quot;SUCCESS&quot;));
<span class="nc" id="L213">        } catch (Exception e) {</span>
<span class="nc" id="L214">            log.error(&quot;Error occurred while fetching Applicant details&quot;, e);</span>
<span class="nc" id="L215">            return new ResponseEntity&lt;&gt;(</span>
                    new ApiResponse&lt;&gt;(null, false, &quot;APPLICANT_DETAILS_FETCH_ERROR&quot;, &quot;FAILURE&quot;,
<span class="nc" id="L217">                            Collections.singletonList(e.getMessage())),</span>
                    HttpStatus.OK);
        }
    }

    @GetMapping(&quot;nonAssociateJobApplicantOffer&quot;)
    public ResponseEntity&lt;ApiResponse&lt;List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; getNonAssociateJobApplicantOffer() {
        try {
<span class="nc" id="L225">            List&lt;Map&lt;String, Object&gt;&gt; employeeJobApplicantResponseDTOS = service.getNonAssociateJobApplicantOffer();</span>
<span class="nc" id="L226">            return ResponseEntity.ok(</span>
                    new ApiResponse&lt;&gt;(employeeJobApplicantResponseDTOS, true, &quot;JOB_APPLICANT_DETAILS_FETCHED&quot;, &quot;SUCCESS&quot;));
<span class="nc" id="L228">        } catch (Exception e) {</span>
<span class="nc" id="L229">            log.error(&quot;Error occurred while fetching job applicant details&quot;, e);</span>
<span class="nc" id="L230">            return new ResponseEntity&lt;&gt;(</span>
                    new ApiResponse&lt;&gt;(null, false, &quot;JOB_APPLICANT_DETAILS_FETCH_ERROR&quot;, &quot;FAILURE&quot;,
<span class="nc" id="L232">                            Collections.singletonList(e.getMessage())),</span>
                    HttpStatus.OK);
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>